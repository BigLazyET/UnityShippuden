# Sprite

> Sprite，又称精灵，是用来存储游戏人物，地图，场景的一种资源
>
> 有时候精灵纹理只包含一个图形元素，但是将多个相关图形组合成单个图像通常更方便；所以大部分通常以一整张图片来呈现
>
> 可以对其进行Sprite Editor设置，处理及其分割等，从而拿到不同的游戏资源

## 一、Sprite的归置
### 1. Sprite资源导入
* 直接将图像拖入Assets/Sprites文件夹（层级目录自行设计）中，然后在弹出框中选择需要导入的资源，确认即可
* 工具栏Assets -> Import new Asset -> 选择图像

### 2. Sprite放置地址
* 常用的以及公用的放在根目录Sprite文件夹下：比如用于制作地图的sprite
* 针对个人的及私有的放在单独对象的文件夹下比较好：比如人物的设计，将sprite单独放在人物文件夹下

## 二、 Sprite设置
**选中Sprite，查看右侧的Inspector面板**
* 纹理类型（Texture Type）设置为Sprite(2D and UI)
* 精灵模式（Sprite Mode）设置为Multiple：适用于当一张图片(纹理)包含了多个元素(人物，敌人，地图等等)，后期我们需要通过Sprite Editor编辑器里的切片slice进行分割的，**当然这也是大部分的情况**

## 三、Sprite编辑器
### 1. Sprite编辑器
* Sprite面板的菜单：缩放，图像显示类型，纹理像素化，Slice，Trim，Apply，Revert
* 选中某一个精灵后的编辑器相关的数据设定：Name, Postition, Border, Pivot等等

### 2. Sprite编辑器之Slice切片菜单
* Slice面板：Type - 手动或i自动提取元素。

### 3. Sprite编辑器之Outline：编辑精灵轮廓，轮廓是用来干嘛的呢
**其本质上还是精确化Sprite的轮廓的作用，比Slice按照特定Type切割更为精确，但是操作稍微复杂些**
* 尽量去掉透明区域，是圈中我们所要的图像区域，提高性能
* 有利于后期精灵之间的碰撞，让碰撞检测更为精确
* 移动轮廓控制点，和按住移动轮廓控制线两种操作可以操作轮廓区域
* 轮廓公差：Outliine Telerance，越高越精确。设置完成后在Scene面板，模式选择Wireframe模式就能看到轮廓控制点如何圈住图像的

## 四、Sprite遮罩
### 1. 相关链接
* [官方文档之精灵遮罩](https://docs.unity3d.com/cn/current/Manual/class-SpriteMask.html)

## 五、Sprite排序
二、精灵
1.分类精灵：对精灵进行排序，有四种透明度排列模式：
a.Default：那么就根据相机的投影模式设置为透视还是正交，进行排序
b.Perspective：透视，基于透视图的排序，根据从相机位置到Sprite中心的距离进行排序
c.正交，根据沿视图方向的距离
d.根据在透明度排序轴中设置的给定轴进行排序
最后当然你也亦可以使用脚本对每个摄像机的sprites进行排序		(TransparencySortMode和TransparencySortAxis)

## 六、Sprite图集 - 涉及性能优化
**请注意 Sprite Packer 在 Unity 2020.1 和更新版本中已弃用，并且将不再作为精灵打包模式的可用选项。现有已使用 Sprite Packer 的项目仍然可以继续使用它，但是在 2020.1 以后创建的任何新项目在打包纹理时将默认使用 Sprite Atlas 系统**
### 1. 相关链接
* [[UGUI性能优化]精灵图集(Sprite Atlas)保姆式教程](https://zhuanlan.zhihu.com/p/456101373)
* [相关知识脑图](./SpriteAtlas.km)

### 2. 原理
* 为了降低性能消耗，我们可以使用精灵图集（Sprite Atlas）技术，它能够将多个纹理（texture）合并成一个大纹理，当访问图集中的多个纹理时，也只需要调用一次DrawCall
* 游戏中的图片模型最终是要给到显卡去渲染的，图片开始是要从硬盘读到内存里面去的，然后CPU通知GPU要开始渲染，这一次通知就是一次Drawcall

### 3. 优点
如【原理】所讲，图集有效减少了DrawCall的次数，避免了不必要的CPU和GPU的性能消耗

### 4. 缺点
内存消耗问题：图集虽然能够有效降低DrawCall，但使用不当容易造成内存资源的浪费
* 当图集中有一个Sprite处于活跃状态时，Unity会加载该Sprite所属图集中的所有纹理
* 如果一个图集中的有许多纹理，就算场景中只有一个纹理被引用，那么整个图集都会被加载，会造成较大的内存消耗

### 5. 优缺点的平衡
我们将场景中激活的所有或大多数纹理都打包到同一个图集，最好根据纹理的常见用途将分别打包成多个较小的图集
* 图集的增多可以减少一次性加载不必要的纹理所带来的内存消耗
* 但是图集的增多还是可能会增加DrawCall的次数，所以我们必须要取舍得当

## 七、其他一些碎碎念

精灵纹理往往在各个图形元素之间留有很多空白，虽然可以采用上面的轮廓公差以及你的耐心来提供精灵轮廓切割，但是并不是最好的方法。为了获得最佳性能，最好将几个精灵纹理的图形包装在一个称为地图集的纹理中(注意，这里说明图集也就是一个纹理，只不过这个纹理里包括各种精灵元素而已)。而Unity因此就提供了一个Sprite Packer实用程序。图集可以自动打包，一旦生成精灵对象图形将从图集中按需获取。
Sprite Packer模式禁用，但可以开启：
   Edit -> Project Settings -> Editor -> Sprite Packer
打开Sprite Packer窗口：Window -> Sprite Pcker
在Sprite Import（纹理导入器）-> 即点击在项目面板里的精灵出来的inspector面板里找到关于打包的几个设置：Packing Tag - 包装标签
具有相同包装标签的所有精灵将被打包在相同的地图集中。
Sprite Packer可自定制：https://docs.unity3d.com/Manual/SpritePacker.html

2D 项目使用精灵和其他图形来创建其场景的视觉效果。这意味着单个项目可能包含许多纹理文件。Unity 通常会为场景中的每个纹理发出一个绘制调用；但是，在具有许多纹理的项目中，多个绘制调用会占用大量资源，并会对项目的性能产生负面影响。

精灵图集 (Sprite Atlas) 是一种将多个纹理合并为一个组合纹理的资源。Unity 可以调用此单个纹理来发出单个绘制调用而不是发出多个绘制调用，能够以较小的性能开销一次性访问压缩的纹理。此外，精灵图集 API 还可以控制如何在项目运行时加载精灵图集。